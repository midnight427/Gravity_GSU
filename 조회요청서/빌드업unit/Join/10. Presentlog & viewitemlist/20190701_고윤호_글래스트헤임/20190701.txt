select a.accountid,a.CharacterID,a.CharacterName,b.name,count(*) as 'Count'
--into requestlog_20190701..Baphomet_Data1(Fragment_Of_Time)
 from 
(select * from  ItemLog_Baphomet_201905..PresentLog union all
select * from  ItemLog_Baphomet_201906..PresentLog union all
select * from  Baphomet.ItemLog.dbo.PresentLog) a
join baphomet.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25867)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by CharacterID

--º’∫º∞Õ(æ»ΩË¿Ω. æ∆∑°≤® æ∏--

with a as(
select accountid,characterid,itemid,count(*) as count1,date from (select * from itemLog_Baphomet_201905..PresentLog union all select * from ItemLog_Baphomet_201906..PresentLog)n
where[date] between '2019-05-22 10:00:00.000'and'2019-06-30 10:00:00.000'
and  itemid=25867
group by accountid, characterid,[date],itemid
)  --select * from a
select accountid,characterid,itemid,count(*) as count2,min(date) as fast 
into #baphomet1
from a
--where count1=10
group by accountid, characterid,itemid
order by 1,2

--drop table #baphomet2
--select * from #baphomet

select *, ROW_NUMBER()over (partition by accountid order by count2 desc, fast) as RANK 
into #baphomet2
from #baphomet1
order by 1,2

select * from #baphomet2

select accountid,characterid,b.name,count2 
into requestlog_20190701..Data1_baphomet
from #baphomet2 a
join baphomet.script.dbo.viewitemlist b on a.ItemID=b.id where rank=1
order by 1,2


with a as(
select accountid,characterid,itemid,count(*) as count1,date from (select * from itemLog_darklord_201905..PresentLog union all select * from ItemLog_darklord_201906..PresentLog)n
where[date] between '2019-05-22 10:00:00.000'and'2019-06-30 10:00:00.000'
and  itemid=25867
group by accountid, characterid,[date],itemid
)  --select * from a
select accountid,characterid,itemid,count(*) as count2,min(date) as fast 
into #darklord1
from a
--where count1=10
group by accountid, characterid,itemid
order by 1,2

--drop table #darklord2
--select * from #darklord

select *, ROW_NUMBER()over (partition by accountid order by count2 desc, fast) as RANK 
into #darklord2
from #darklord1
order by 1,2

select * from #darklord2

select accountid,characterid,b.name,count2 
into requestlog_20190701..Data1_darklord
from #darklord2 a
join darklord.script.dbo.viewitemlist b on a.ItemID=b.id where rank=1
order by 1,2


with a as(
select accountid,characterid,itemid,count(*) as count1,date from (select * from itemLog_yggdrasil_201905..PresentLog union all select * from ItemLog_yggdrasil_201906..PresentLog)n
where[date] between '2019-05-22 10:00:00.000'and'2019-06-30 10:00:00.000'
and  itemid=25867
group by accountid, characterid,[date],itemid
)  --select * from a
select accountid,characterid,itemid,count(*) as count2,min(date) as fast 
into #yggdrasil1
from a
--where count1=10
group by accountid, characterid,itemid
order by 1,2

--drop table #yggdrasil2
--select * from #yggdrasil

select *, ROW_NUMBER()over (partition by accountid order by count2 desc, fast) as RANK 
into #yggdrasil2
from #yggdrasil1
order by 1,2

select * from #yggdrasil2

select accountid,characterid,b.name,count2 
into requestlog_20190701..Data1_yggdrasil
from #yggdrasil2 a
join baphomet.script.dbo.viewitemlist b on a.ItemID=b.id where rank=1
order by 1,2

select a.accountid,a.CharacterID,b.name,count(*) as 'Count'
into requestlog_20190701..Data2_baphomet
 from 
(select * from  ItemLog_baphomet_201905..PresentLog union all
select * from  ItemLog_baphomet_201906..PresentLog union all
select * from  baphomet.ItemLog.dbo.PresentLog) a
join baphomet.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25865)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by AccountID, CharacterID

select a.accountid,a.CharacterID,b.name,count(*) as 'Count'
into requestlog_20190701..Data2_Baphomet
 from 
(select * from  ItemLog_Baphomet_201905..PresentLog union all
select * from  ItemLog_Baphomet_201906..PresentLog union all
select * from  Baphomet.ItemLog.dbo.PresentLog) a
join baphomet.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25865)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by AccountID, CharacterID

select a.accountid,a.CharacterID,b.name,count(*) as 'Count'
into requestlog_20190701..Data2_darklord
 from 
(select * from  ItemLog_darklord_201905..PresentLog union all
select * from  ItemLog_darklord_201906..PresentLog union all
select * from  darklord.ItemLog.dbo.PresentLog) a
join darklord.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25865)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by AccountID, CharacterID

select a.accountid,a.CharacterID,b.name,count(*) as 'Count'
into requestlog_20190701..Data2_yggdrasil
 from 
(select * from  ItemLog_yggdrasil_201905..PresentLog union all
select * from  ItemLog_yggdrasil_201906..PresentLog union all
select * from  yggdrasil.ItemLog.dbo.PresentLog) a
join yggdrasil.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25865)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by AccountID, CharacterID


select a.accountid,a.CharacterID,b.name,count(*) as 'Count'
into requestlog_20190701..Data3_baphomet
 from 
(select * from  ItemLog_baphomet_201905..PresentLog union all
select * from  ItemLog_baphomet_201906..PresentLog union all
select * from  baphomet.ItemLog.dbo.PresentLog) a
join baphomet.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25866)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by AccountID, CharacterID

select a.accountid,a.CharacterID,b.name,count(*) as 'Count'
into requestlog_20190701..Data3_darklord
 from 
(select * from  ItemLog_darklord_201905..PresentLog union all
select * from  ItemLog_darklord_201906..PresentLog union all
select * from  darklord.ItemLog.dbo.PresentLog) a
join darklord.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25866)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by AccountID, CharacterID

select a.accountid,a.CharacterID,b.name,count(*) as 'Count'
into requestlog_20190701..Data3_yggdrasil
 from 
(select * from  ItemLog_yggdrasil_201905..PresentLog union all
select * from  ItemLog_yggdrasil_201906..PresentLog union all
select * from  yggdrasil.ItemLog.dbo.PresentLog) a
join yggdrasil.script.dbo.viewitemlist b
on a.itemid=b.id
where [date] between '2019-05-22 10:00:00.000'and'2019-06-30 23:59:59.999'
and itemid in (25866)
group by AccountID,CharacterID,CharacterName,itemid, b.name
order by AccountID, CharacterID